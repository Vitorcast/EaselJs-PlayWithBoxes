<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="easeljs-0.8.2.min.js"></script>
    <script src="tweenjs-0.6.2.min.js"></script>
</head>

<body onload="init()" style="margin: 20px">

<canvas id="canvas" width="800" height="600" style="border: black solid 1px"></canvas>

</body>

<script>
    var stage;
    var player = new Player();
    var rect;
    player.positionX = 4;
    player.positionY = 3;
    
    const E=0,W=1,P=2, G=3, F=4; //Empty
    const objets=['Empty', 'Wall', 'Player', 'Goal', 'Fog'];
    const envColors=['white', 'orange', 'blue', 'green', 'grey'];

    
    const ARROW_KEY_LEFT = 37;
    const ARROW_KEY_UP = 38;
    const ARROW_KEY_RIGHT = 39;
    const ARROW_KEY_DOWN = 40;

    var world = [
        [W,W,G,W,W,W],
        [W,E,E,E,E,W],
        [W,E,W,E,E,W],
        [W,W,W,W,P,W]
    ];

    var foggedWorld = [
        [F,F,F,F,F,F],
        [F,F,F,F,F,F],
        [F,F,F,F,F,F],
        [F,F,F,F,P,F]
    ];
   
    function $(id){return document.getElementById(id);}

    function init() {
        stage = new createjs.Stage(document.getElementById('canvas'));
        createjs.Ticker.addEventListener("tick", handleTick);
        createjs.Ticker.setFPS(60);
        start();
    }
    
    function handleTick(e) {
        window.onkeydown = onDPad;      
        generateWorld($('canvas'), this.foggedWorld);
        stage.update();
    }

    function generateRectangle(sC, fC, x, y, w, h){
        var rectangle = new createjs.Shape();
        rectangle.graphics.beginStroke(sC);
        rectangle.graphics.beginFill(fC);
        rectangle.graphics.drawRect(0, 0, w, h);
        rectangle.x = x
        rectangle.y = y;        
        return rectangle;
        
    }

    function generateCircle(sC, fC, x, y, width, heigh, radius){
        var circle = new createjs.Shape();
        circle.graphics.beginStroke(sC);
        circle.graphics.beginFill(fC);
        circle.graphics.drawCircle(width, heigh, radius);
        circle.x = x;
        circle.y = y;
        return circle;
    }   

    function generateTriangle(sC, fC, x, y, startX, startY, points){
        var tri = new createjs.Shape();
        tri.graphics.beginStroke(sC);
        tri.graphics.beginFill(fC);
        tri.graphics.moveTo(50, 0)
                .lineTo(0, 100)
                .lineTo(100, 100)
                .lineTo(50, 0);
        tri.x = 20;
        tri.y = 150;   
        return tri;     
    }   

    function generateStar(sC, fC, x, y, startX, startY,  radius,  sides,  pointSize){
        var poly = new createjs.Shape();
        poly.graphics.beginStroke(sC);
        poly.graphics.beginFill(fC);
        poly.graphics.drawPolyStar(startX, startY,radius,  sides,  pointSize);
        poly.x = x;
        poly.y = y;
        return poly;     
    } 
    function generateRoundedRectangle(sC, fC, x, y, startX,  startY,  w,  h,  radiusTL,  radiusTR,  radiusBR,  radiusBL ){
         var roundedRectangle = new createjs.Shape();
        roundedRectangle.graphics.beginStroke('#000');
        roundedRectangle.graphics.beginFill('#F7D0D1');
        roundedRectangle.graphics.drawRoundRect( startX,  startY,  w,  h,  radiusTL,  radiusTR,  radiusBR,  radiusBL);
        roundedRectangle.x = roundedRectangle.y = x;
        return roundedRectangle;
    }

    function generateWorld(root, world){      
        var x=0;
        var y=0;  
        var rect;      
        blockWidth = root.width / world[0].length;
        blockHeight = root.height/ world.length;
       

        world.forEach(er => {
            er.forEach(ec => {       
                fillCollor=envColors[ec]; 
                rect = generateRectangle('black',fillCollor,x,y,blockWidth,blockHeight);   
                if (envColors[ec] == 'blue') this.player.playerRect = rect;                 
                stage.addChild(rect);                
                x += blockWidth; 
            })
            x = 0;            
            y += blockHeight;            
        });
        
    }
    
    function onDPad(e){              
        switch (e.keyCode){           
            case ARROW_KEY_LEFT:
                console.log('move left');                               
                player.setPosition(player.positionX - 1, player.positionY);
                break;
            case ARROW_KEY_UP:
                console.log('move up');
                player.setPosition(player.positionX, player.positionY - 1); 
                break;
            case ARROW_KEY_RIGHT:
                console.log('move right');
                player.setPosition(player.positionX + 1, player.positionY); 
                break;
            case ARROW_KEY_DOWN:
                console.log('move down');
                player.setPosition(player.positionX, player.positionY + 1); 
                break;
        }
    }

   
    function start() {
        //RECTANGLE
        // var rectangle = new createjs.Shape();
        // rectangle.graphics.beginStroke('#000');
        // rectangle.graphics.beginFill('#FF0000');
        // rectangle.graphics.drawRect(0, 0, 150, 100);
        // rectangle.x = rectangle.y = 20;
        // stage.addChild(rectangle);

        ///CIRCLE
        // var circle = new createjs.Shape();
        // circle.graphics.beginStroke('#000');
        // circle.graphics.beginFill('#FFF000');
        // circle.graphics.drawCircle(0, 0, 50);
        // circle.x = 250;
        // circle.y = 70;
        //stage.addChild(generateCirle('#000', '#FFF000', 250, 70, 0, 0, 50));

        // //STAR
        // var poly = new createjs.Shape();
        // poly.graphics.beginStroke('#000');
        // poly.graphics.beginFill('#90ABC2');
        // poly.graphics.drawPolyStar(0, 0, 60, 6, 0.6);
        // poly.x = 400;
        // poly.y = 70;
        // stage.addChild(poly);

        // //TRIANGLE
        // var tri = new createjs.Shape();
        // tri.graphics.beginStroke('#000');
        // tri.graphics.beginFill('#00FF00');
        // tri.graphics.moveTo(50, 0)
        //         .lineTo(0, 100)
        //         .lineTo(100, 100)
        //         .lineTo(50, 0);
        // tri.x = 20;
        // tri.y = 150;
        // stage.addChild(tri);

        // ///ROUNDED RECTANGLE
        // var roundedRectangle = new createjs.Shape();
        // roundedRectangle.graphics.beginStroke('#000');
        // roundedRectangle.graphics.beginFill('#F7D0D1');
        // roundedRectangle.graphics.drawRoundRect(0,0,400,100,10);
        // roundedRectangle.x = roundedRectangle.y = 150;
        // stage.addChild(roundedRectangle);

        // stage.addChild(getRectangle('#000', '#FF0000', 20,20, 150, 100));

        //var rectangleWorld = getRectangle('#000', 'white', 20, 0, 50,100);
        //stage.addChild(rectangleWorld);

        // stage.addChild(generateCircle('black', 'white', 250, 70, 50, 50, 50 ));
        // stage.addChild(generateRectangle('black', 'white', 20,20, 150, 100));
        // stage.addChild(generateTriangle('black', 'white', 20, 20, 0, 150, 100));      
        // stage.addChild(generateStar('black', 'white', 400, 70, 0,0,60,6,0.6));
        // stage.addChild(generateRoundedRectangle('black', 'white', 150, 150, 0,0,400,100,10));

       //generateWorld($('canvas'), this.world);

    }

    function Player(){
        var positionX = 0;
        var positionY = 0;
        var playerRect = new createjs.Shape();
    }

    Player.prototype.setPosition = function (x, y){        
        if(world[y] != null) {
            if(world[y][x] != null){
                if (world[y][x] != W){
                    if( y <= world.length && y != this.positionY ) { 
                        let oldY = this.positionY;                
                        this.positionY = y; 
                        world[y][x] = P;
                        world[oldY][this.positionX] = E;  
                        foggedWorld[y][x] = P;
                        foggedWorld[oldY][this.positionX] = E;  
                        //createjs.Tween.get(player.playerRect).to({alpha:0}, 1000);
                        //createjs.Tween.get(player.playerRect).to({alpha:0, y:player.playerRect.y - 100}, 1000);
                    }           
                    if (x <= world[0].length && x != this.positionX) { 
                        let oldX = this.positionX;                
                        this.positionX = x;
                        world[y][x] = P;
                        world[this.positionY][oldX] = E;
                        foggedWorld[y][x] = P;
                        foggedWorld[this.positionY][oldX] = E;
                    }
                } else { 
                    foggedWorld[y][x] = W;                    
                    alert('Boom... hit the wall!');
                }
            } else alert('There is no escape from The Maze');
        } else alert('There is no escape from The Maze');
    }

</script>

</html>